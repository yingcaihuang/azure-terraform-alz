# validate-alz.sh åŠŸèƒ½å®Œæ•´æ€§è¯„ä¼°æŠ¥å‘Š

**è¯„ä¼°æ—¥æœŸ**: 2025-12-16  
**è„šæœ¬æ–‡ä»¶**: `./validate-alz.sh`  
**è¯„ä¼°é—®é¢˜**: è¿™ä¸ªè„šæœ¬ç°åœ¨æ˜¯æœ€å…¨åŠŸèƒ½çš„æ ¡éªŒå—ï¼Ÿ

---

## ğŸ“‹ ç»“è®º

âŒ **å½“å‰çš„ `validate-alz.sh` ä¸æ˜¯æœ€å…¨åŠŸèƒ½çš„æ ¡éªŒ**

è¯¥è„šæœ¬å·²èƒ½å¤ŸéªŒè¯æ ¸å¿ƒåŠŸèƒ½ï¼Œä½†**ç¼ºå°‘å¯¹æœ€æ–°åŠŸèƒ½çš„æ£€æŸ¥**ã€‚

---

## âœ… å½“å‰è„šæœ¬åŒ…å«çš„éªŒè¯

### 1. åŸºç¡€ç¯å¢ƒæ£€æŸ¥
- âœ… Azure CLI å®‰è£…å’Œç™»å½•çŠ¶æ€
- âœ… Terraform ç‰ˆæœ¬è¦æ±‚ï¼ˆ>= 1.5.0ï¼‰
- âœ… Terraform é…ç½®æœ‰æ•ˆæ€§

### 2. é…ç½®æ–‡ä»¶æ£€æŸ¥
- âœ… terraform.tfvars æ–‡ä»¶å­˜åœ¨æ€§
- âœ… å¿…éœ€å˜é‡æ£€æŸ¥ï¼ˆroot_management_group_name, resource_prefix, locationï¼‰
- âœ… ç½‘ç»œæ¶æ„éªŒè¯ï¼ˆHub & Spoke / Virtual WAN / Noneï¼‰
- âœ… ç­–ç•¥æ‰§è¡Œæ¨¡å¼æ£€æŸ¥

### 3. Azure æƒé™æ£€æŸ¥
- âœ… å½“å‰è®¢é˜…ä¿¡æ¯
- âœ… ç®¡ç†ç»„æƒé™éªŒè¯

### 4. Plan éªŒè¯
- âœ… Terraform plan æ‰§è¡Œï¼ˆdry-runï¼‰
- âœ… ä»£ç æ ¼å¼åŒ–

---

## âŒ å½“å‰è„šæœ¬**ç¼ºå°‘**çš„æ–°åŠŸèƒ½æ£€æŸ¥

### 1. **Compute æ¨¡å—éªŒè¯**
- âŒ deploy_compute_resources å˜é‡æ£€æŸ¥
- âŒ VM é…ç½®éªŒè¯ï¼ˆvm_size, vm_os_typeï¼‰
- âŒ å…¬ç½‘ IP åˆ†é…æ£€æŸ¥

### 2. **SSH å¯†é’¥ç”ŸæˆåŠŸèƒ½** â­ æ–°åŠŸèƒ½
- âŒ generate_ssh_key å˜é‡æ£€æŸ¥
- âŒ æœ¬åœ° SSH å¯†é’¥éªŒè¯
- âŒ SSH å¯†é’¥ç”Ÿæˆæ¨¡å¼è­¦å‘Š

### 3. **Azure Monitor é›†æˆ** â­ æ–°åŠŸèƒ½  
- âŒ enable_azure_monitor å˜é‡æ£€æŸ¥
- âŒ deploy_log_analytics_workspace éªŒè¯
- âŒ Monitor Agent é…ç½®æ£€æŸ¥

### 4. **TLS Provider æ£€æŸ¥** â­ æ–°åŠŸèƒ½
- âŒ tls provider ä¾èµ–æ£€æŸ¥ï¼ˆç”¨äº SSH å¯†é’¥ç”Ÿæˆï¼‰

### 5. **å®‰å…¨æ£€æŸ¥**
- âŒ State æ–‡ä»¶ä¿æŠ¤å»ºè®®ï¼ˆç‰¹åˆ«æ˜¯ SSH å¯†é’¥ç”Ÿæˆæ—¶ï¼‰
- âŒ ç¯å¢ƒåˆ†ç±»å»ºè®®ï¼ˆç”Ÿäº§/å¼€å‘ï¼‰

---

## ğŸ“Š åŠŸèƒ½è¦†ç›–ç‡

```
æ€»éªŒè¯é¡¹: 4 ç±»
å½“å‰è¦†ç›–: 2 ç±» (50%)
ç¼ºå¤±è¦†ç›–: 2 ç±» (50%)
â”œâ”€ Compute æ¨¡å—åŠ SSH å¯†é’¥: âŒ æœªæ£€æŸ¥
â”œâ”€ Azure Monitor: âŒ æœªæ£€æŸ¥
â”œâ”€ å®‰å…¨å»ºè®®: âŒ æœªæ£€æŸ¥
â””â”€ æ–° Provider (TLS): âŒ æœªæ£€æŸ¥
```

---

## ğŸ”§ å¢å¼ºå»ºè®®

è„šæœ¬åº”è¯¥æ·»åŠ ä»¥ä¸‹æ£€æŸ¥ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ï¼š

### ã€é«˜ä¼˜å…ˆçº§ã€‘å¿…é¡»æ·»åŠ 
1. **Compute æ¨¡å—æ£€æŸ¥**
   ```bash
   if grep -q "deploy_compute_resources.*true" terraform.tfvars; then
       echo "âœ… Compute æ¨¡å—å·²å¯ç”¨"
       # æ£€æŸ¥ SSH å¯†é’¥é…ç½®
   fi
   ```

2. **SSH å¯†é’¥ç”Ÿæˆæ£€æŸ¥** 
   ```bash
   SSH_KEY_GEN=$(grep "generate_ssh_key" terraform.tfvars | grep -o "true\|false")
   if [ "$SSH_KEY_GEN" = "true" ]; then
       echo "âš ï¸  Terraform å°†ç”Ÿæˆ SSH å¯†é’¥ - è¯·ä¿æŠ¤ State æ–‡ä»¶ï¼"
   fi
   ```

3. **Azure Monitor æ£€æŸ¥**
   ```bash
   if grep -q "enable_azure_monitor.*true" terraform.tfvars; then
       echo "âœ… Azure Monitor å·²å¯ç”¨"
   fi
   ```

### ã€ä¸­ä¼˜å…ˆçº§ã€‘å»ºè®®æ·»åŠ 
4. VM é…ç½®éªŒè¯ï¼ˆvm_size, vm_os_typeï¼‰
5. Log Analytics å·¥ä½œåŒºéªŒè¯
6. æœ¬åœ° SSH å…¬é’¥æ–‡ä»¶æ£€æŸ¥

### ã€ä½ä¼˜å…ˆçº§ã€‘å¯é€‰æ·»åŠ 
7. State æ–‡ä»¶å®‰å…¨å»ºè®®
8. éƒ¨ç½²æ–¹æ¡ˆå»ºè®®
9. æˆæœ¬ä¼°ç®—æç¤º

---

## ğŸ’¡ ç°æœ‰æ›¿ä»£æ–¹æ¡ˆ

è™½ç„¶ `validate-alz.sh` ä¸å¤Ÿå®Œæ•´ï¼Œä½†é¡¹ç›®ä¸­æœ‰å…¶ä»–è„šæœ¬å¯ç”¨ï¼š

| è„šæœ¬ | åŠŸèƒ½ | æ˜¯å¦å……åˆ† |
|------|------|---------|
| `./validate-alz.sh` | åŸºç¡€éªŒè¯ | âš ï¸ éƒ¨åˆ† |
| `./show-vm-info.sh` | VM ä¿¡æ¯å±•ç¤º | âœ… å……åˆ† |
| `./ssh-key-demo.sh` | SSH å¯†é’¥æ¼”ç¤º | âœ… å……åˆ† |
| `terraform validate` | é…ç½®éªŒè¯ | âœ… å……åˆ† |
| `terraform plan` | å®Œæ•´è®¡åˆ’ | âœ… å……åˆ† |

---

## ğŸ“ˆ æ”¹è¿›æ–¹æ¡ˆ

### æ–¹æ¡ˆ Aï¼šå¿«é€Ÿä¿®å¤ï¼ˆ20 åˆ†é’Ÿï¼‰
åœ¨ç°æœ‰è„šæœ¬ä¸­æ·»åŠ ä»¥ä¸‹å‡ è¡Œæ£€æŸ¥ï¼š
```bash
# åœ¨å˜é‡æ£€æŸ¥åæ·»åŠ 
echo ""
echo "Validating new features..."

# Compute & SSH Keys
grep -q "deploy_compute_resources.*true" terraform.tfvars && \
    echo "âœ… Compute module enabled" || \
    echo "â„¹ï¸  Compute module disabled"

# Azure Monitor  
grep -q "enable_azure_monitor.*true" terraform.tfvars && \
    echo "âœ… Azure Monitor enabled" || \
    echo "â„¹ï¸  Azure Monitor disabled"
```

### æ–¹æ¡ˆ Bï¼šå®Œæ•´é‡æ„ï¼ˆ1 å°æ—¶ï¼‰
åˆ›å»ºæ–°çš„å¢å¼ºè„šæœ¬ `validate-alz-full.sh`ï¼ŒåŒ…å«ï¼š
- æ‰€æœ‰æ–°åŠŸèƒ½æ£€æŸ¥
- è¯¦ç»†çš„å®‰å…¨å»ºè®®
- äº¤äº’å¼è¯Šæ–­
- äººç±»å¯è¯»çš„è¾“å‡º

### æ–¹æ¡ˆ Cï¼šè„šæœ¬æ¨¡å—åŒ–ï¼ˆæ¨èé•¿æœŸæ–¹æ¡ˆï¼‰
åˆ›å»ºå­è„šæœ¬åº“ï¼š
```
scripts/
â”œâ”€â”€ validate-alz.sh           # æ ¸å¿ƒéªŒè¯
â”œâ”€â”€ validate-compute.sh       # Compute æ¨¡å—æ£€æŸ¥
â”œâ”€â”€ validate-ssh-keys.sh      # SSH å¯†é’¥æ£€æŸ¥
â”œâ”€â”€ validate-monitor.sh       # Monitor æ£€æŸ¥
â””â”€â”€ validate-security.sh      # å®‰å…¨æ£€æŸ¥
```

---

## ğŸ¯ ç«‹å³è¡ŒåŠ¨å»ºè®®

### å¦‚æœæ‚¨éœ€è¦å®Œæ•´éªŒè¯ï¼ˆç°åœ¨ï¼‰
è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥è¿›è¡Œå…¨é¢æ£€æŸ¥ï¼š
```bash
# 1. åŸºç¡€éªŒè¯
./validate-alz.sh

# 2. VM å’Œ SSH å¯†é’¥æ£€æŸ¥
bash ssh-key-demo.sh

# 3. å®Œæ•´è®¡åˆ’éªŒè¯
terraform plan

# 4. VM ä¿¡æ¯æ£€æŸ¥ï¼ˆéƒ¨ç½²åï¼‰
./show-vm-info.sh
```

### å¦‚æœæ‚¨éœ€è¦ç°ä»£åŒ–éªŒè¯è„šæœ¬ï¼ˆé•¿æœŸï¼‰
å»ºè®®æˆ‘ä»¬åˆ›å»ºå¢å¼ºç‰ˆæœ¬ `validate-alz-full.sh`ï¼ŒåŒ…å«ï¼š
- âœ… æ‰€æœ‰æ–°åŠŸèƒ½æ£€æŸ¥
- âœ… æ›´å¥½çš„é”™è¯¯å¤„ç†
- âœ… å®‰å…¨æœ€ä½³å®è·µæ£€æŸ¥
- âœ… å½©è‰²è¾“å‡ºå’Œè¯¦ç»†æŠ¥å‘Š

---

## ğŸ“ æ€»ç»“

| æ–¹é¢ | å½“å‰çŠ¶æ€ | å»ºè®® |
|------|---------|------|
| **åŸºç¡€éªŒè¯** | âœ… å®Œæ•´ | ä¿æŒç°çŠ¶ |
| **Compute æ¨¡å—** | âŒ ç¼ºå¤± | åº”æ·»åŠ  |
| **SSH å¯†é’¥ç”Ÿæˆ** | âŒ ç¼ºå¤± | åº”æ·»åŠ ï¼ˆé‡è¦ï¼‰ |
| **Azure Monitor** | âŒ ç¼ºå¤± | åº”æ·»åŠ  |
| **å®‰å…¨æ£€æŸ¥** | âŒ ç¼ºå¤± | åº”æ·»åŠ  |
| **æ•´ä½“å®Œæ•´æ€§** | âš ï¸ 50% | éœ€è¦æ”¹è¿› |

---

## âœ… åç»­æ­¥éª¤

1. **äº†è§£å½“å‰èƒ½åŠ›** - å½“å‰è„šæœ¬å¯å¤„ç†åŸºç¡€éªŒè¯ âœ…
2. **è¯†åˆ«å·®è·** - æ–°åŠŸèƒ½ï¼ˆCompute, SSH, Monitorï¼‰æœªè¢«è¦†ç›– âš ï¸
3. **ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ** - ä½¿ç”¨å…¶ä»–è„šæœ¬æˆ–å‘½ä»¤å¼¥è¡¥å·®è· âœ…
4. **è€ƒè™‘å‡çº§** - åç»­å¯æ”¹è¿›è„šæœ¬ä»¥è¦†ç›–æ‰€æœ‰åŠŸèƒ½ ğŸ’¡

---

**æŠ¥å‘Šç”Ÿæˆ**: 2025-12-16  
**ç‰ˆæœ¬**: 1.0  
**å»ºè®®**: è”ç³»å›¢é˜Ÿå‡çº§ `validate-alz.sh` ä»¥æ”¯æŒæ‰€æœ‰æ–°åŠŸèƒ½
